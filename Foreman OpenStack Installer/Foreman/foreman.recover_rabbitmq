# Rejoin a cluster: WARNING, NOT FULLY QAed!
# On all the nodes:
rm -rf /var/lib/rabbitmq/*
# On one node start rabbitmq-server to create the cookie and copy it to the other nodes:
systemctl start rabbitmq-server
scp -p /var/lib/rabbitmq/.erlang.cookie controller2.vm.lab:/var/lib/rabbitmq/
scp -p /var/lib/rabbitmq/.erlang.cookie controller3.vm.lab:/var/lib/rabbitmq/

# Start rabbitmq-server in the other two nodes
systemctl start rabbitmq-server

# Set the HA Policy (https://www.rabbitmq.com/ha.html)
rabbitmqctl set_policy ha-all "^ha\." '{"ha-mode":"all"}'
rabbitmqctl cluster_status

# Clean up the resource in pacemaker
pcs resource cleanup rabbitmq-server
